std::auto_ptr<QOMSG> lastElm(paragraphElement->getLastArrayItemInVector("elm"));
                if(!lastElm.get() || (lastElm.get()->getPropertyAsString("etp") ? lastElm.get()->getPropertyAsString("etp") : "") == std::string("eop"))
                {
                    VRun emptyRun = VisualRuns::GetSingleton()->AddAnchor(start);
                    VisualRuns::GetSingleton()->SetLength(emptyRun.Id(),0);
                    
                    msgAutoPtr emptyNcrElement(QOMSG::Alloc());

                    if (hyperlink != NULL) {
                      add_element_header(emptyNcrElement.get(),"hlk","HLK",emptyRun.Id());
                      emptyNcrElement->setPropertyAsString("lnk",hyperlink);

                      msgAutoPtr tmpNcrElement(QOMSG::Alloc());
                      add_element_header(tmpNcrElement.get(),"ncr","CHA",emptyRun.Id());
                      add_run_info(tmpNcrElement.get(),
                                   iter->text.c_str(),
                                   font_name.c_str(),
                                   size,
                                   color_str,
                                   highlight_str,
                                   bold,
                                   italic,
                                   underline,
                                   strikethrough,
                                   hidden,
                                   subscript,
                                   superscript,
                                   isPageField,
                                   allCaps,
                                   smallCaps);

                      add_element_array_object(emptyNcrElement.get(), tmpNcrElement.get());
                    } else if (bookMarks.size()) {

                      for (int i = 0; i < bookMarks.size(); i++) {
                        msgAutoPtr bookmarkElement(QOMSG::Alloc());
                        std::string id_str = IdStringUtils::CreateIdString("BMK", i);
                        add_element_header(bookmarkElement.get(),"bmk",id_str.c_str(),emptyRun.Id());
                        add_character_run_ID(bookmarkElement.get(),emptyRun.Id());
                        bookmarkElement->setPropertyAsString("bmkName",bookMarks[i].c_str());
                        add_element_array_object(paragraphElement, bookmarkElement.get());
                      }

                      add_element_header(emptyNcrElement.get(),"ncr","CHA",emptyRun.Id());
                      add_run_info(emptyNcrElement.get(),
                                   iter->text.c_str(),
                                   font_name.c_str(),
                                   size,
                                   color_str,
                                   highlight_str,
                                   bold,
                                   italic,
                                   underline,
                                   strikethrough,
                                   hidden,
                                   subscript,
                                   superscript,
                                   isPageField,
                                   allCaps,
                                   smallCaps);

                    } else {
                      add_element_header(emptyNcrElement.get(),"ncr","CHA",emptyRun.Id());
                      add_run_info(emptyNcrElement.get(),
                                   iter->text.c_str(),
                                   font_name.c_str(),
                                   size,
                                   color_str,
                                   highlight_str,
                                   bold,
                                   italic,
                                   underline,
                                   strikethrough,
                                   hidden,
                                   subscript,
                                   superscript,
                                   isPageField,
                                   allCaps,
                                   smallCaps);
                    }
                  add_element_array_object(paragraphElement, emptyNcrElement.get());
                }